<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>楼层滚动</title>
    <link rel="stylesheet" href="public/static/common/css/base.css">
    <link rel="stylesheet" href="public/static/common/css/public.css">
    <link rel="stylesheet" href="public/static/factory/css/main.css">
    <link rel="stylesheet" href="public/static/common/js/layer.mobile/need/layer.css">
    <style>
        body{
            width:100%;
        }
        .nav-floor{
            position:fixed;
            left:0;
            top:0;
            width:100%;
            height:42px;
            line-height:42px;
            background: #fff;
            border-bottom:1px solid #333;
        }
        .nav-floor a{
            width:33.3%;
            text-align:center;
            box-sizing: border-box;
        }
        .nav-floor a.active{
            background: #000;
            color:#fff;
        }
        .floor{
            height:600px;
        }
        .floor-content{
            margin:42px 0 0;
        }
    </style>
</head>
<body>
<div class="scrollwrapper">
    <nav class="columns_flex nav-floor">
        <a href="javascript:;" data-floor="a">详情1</a>
        <a href="javascript:;" data-floor="b">详情2</a>
        <a href="javascript:;" data-floor="c">详情3</a>
        <a href="javascript:;" data-floor="c">详情4</a>
    </nav>
    <div class="floor-content">
        <div id="a" class="floor">a</div>
        <div id="b" class="floor">b</div>
        <div id="c" class="floor">c</div>
        <div id="d" class="floor">d</div>
    </div>
</div>
<script type="text/javascript" src="public/static/common/js/jquery-1.9.1.min.js"></script>
<script>
    $(function($){
        //简单的点击楼层，不能和滚动楼层混合
        // $('.nav-floor a').on('click',function(){
        //     var _this=$(this);
        //     var floorId=$(this).data('floor');
        //     //var floorArr=$('.item');
        //     $.each($('.item'),function(){
        //         var floorScroll=$(this).attr('id');
        //         var h=$(this).offset().top;
                
        //         if(floorId==floorScroll){
        //             _this.addClass('active').siblings().removeClass('active');
        //             var abc=h-50;
        //             $('body,html').animate({'scrollTop':abc+'px'},800);
        //         }
        //     });
        // });
        // $('.nav-floor a').on('click',function(){
        //     var i=$(this).index();
        //     var abc=$('.menu-cont')[0].offsetTop+$('.item').outerHeight(true)*i;
        //     $('body,html').animate({'scrollTop':abc+'px'},800);
             
        // });
        // $(document).on('scroll',function(){
        //     var menucont=$('.menu-cont')[0].offsetTop;
        //     var scrollTop=$(window).scrollTop();
        //     var childH=$('.item').outerHeight(true);
        //     console.log(menucont+'\n'+scrollTop);
        //     result=scrollTop-menucont;
        //     n=Math.floor(result/childH);
            // if(result>=0){
            //     $('.nav-floor a').removeClass('active').eq(n).addClass('active');
            // }
            
        // });
      
        $.fn.scrollFloor=function(options){
           
            var defaults={
                floorNavMenu:'nav-floor',
                floorContent:'floor-content',
                floorContentChild:'floor',
                activeClass:'active'
            };
            var settings=$.extend(defaults,options);
            $(document).scroll(function(){
                 
                var parentHeight=$('.'+settings.floorContent).height(),
                    parentOffsetTop=$('.'+settings.floorContent)[0].offsetTop,
                    childHeight=$('.'+settings.floorContentChild).outerHeight(true),
                    docScrollTop=$(window).scrollTop();
                    result=docScrollTop-parentOffsetTop;
                    n=Math.floor(result/childHeight);
                    console.log(n);
                    if(result>=0){
                        
                        $('.'+settings.floorNavMenu).children().removeClass(settings.activeClass).eq(n).addClass(settings.activeClass);
                    }
            });
            $('.'+settings.floorNavMenu).children().on('click',function(){
                var i=$(this).index();
                var scrollFloorH=$('.'+settings.floorContent)[0].offsetTop+$('.'+settings.floorContentChild).outerHeight(true)*i;
                $('body,html').animate({'scrollTop':scrollFloorH+'px'},800);
            })
        }
    }(jQuery));
    $('.scrollwrapper').scrollFloor();
</script>
</body>

</html>